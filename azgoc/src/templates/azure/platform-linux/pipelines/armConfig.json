{
  "armTemplates": [
    {
      "name": "AppInsights",
      "templateFolder": "Microsoft.Insights",
      "templateFile": "Microsoft.Insights.Components.json",
      "parameters": [
        {
          "name": "applicationInsightsName",
          "value": "#{applicationInsightsName}#"
        },
        {
          "name": "keyVaultName",
          "value": "#{keyVaultName}#"
        }
      ]
    },
    {
      "name": "keyvaultpolicies",
      "templateFolder": "Microsoft.KeyVault",
      "templateFile": "Microsoft.KeyVault.AccessPolicies.json",
      "parameters": [
        {
          "name": "keyVaultName",
          "value": "#{keyVaultName}#"
        },
        {
          "name": "resourceObjectId",
          "value": "#{serviceConnectionObjectId}#"
        },
        {
          "name": "secretsPermissions",
          "value": ["Get", "List", "Set"]
        }
      ]
    },
    {
      "name": "HostingPlan",
      "templateFolder": "Microsoft.Web",
      "templateFile": "Microsoft.Web.ServerFarms.Container.json",
      "parameters": [
        {
          "name": "hostingPlanName",
          "value": "#{hostingPlanName}#"
        },
        {
          "name": "skuName",
          "value": "#{skuName}#"
        },
        {
          "name": "kind",
          "value": "#{hostingPlanKind}#"
        },
        {
          "name": "reserved",
          "value": true
        },
        {
          "name": "hyperV",
          "value": false
        },
        {
          "name": "location",
          "value": "#{location}#"
        }
      ]
    },
    {
      "name": "WebAppContainer",
      "templateFolder": "Microsoft.Web",
      "templateFile": "Microsoft.Web.Sites.Container.json",
      "parameters": [
        {
          "name": "appName",
          "value": "#{webAppName}#"
        },
        {
          "name": "applicationInsightsInstrumentationKey",
          "value": "[reference('AppInsights').outputs.instrumentationKey.value]"
        },
        {
          "name": "applicationInsightsName",
          "value": "#{applicationInsightsName}#"
        },
        {
          "name": "kind",
          "value": "#{webAppKind}#"
        },
        {
          "name": "omsWorkspaceRG",
          "value": "#{omsWorkspaceRG}#"
        },
        {
          "name": "omsWorkspaceName",
          "value": "#{omsWorkspaceName}#"
        },
        {
          "name": "keyVaultName",
          "value": "#{keyVaultName}#"
        },
        {
          "name": "secretPermissions",
          "value": ["Get", "List", "Set"]
        },
        {
          "name": "addDiagnosticSettings",
          "value": true
        },
        {
          "name": "osVersion",
          "value": "#{osVersion}#"
        },
        {
          "name": "hostingPlanName",
          "value": "#{hostingPlanName}#"
        },
        {
          "name": "aspResourceGroup",
          "value": "#{aspResourceGroup}#"
        },
        {
          "name": "dockerImageName",
          "value": "#{dockerImageName}#"
        },
        {
          "name": "dockerRegistryUrl",
          "value": "#{dockerRegistryUrl}#"
        },
        {
          "name": "dockerRegistryUsername",
          "value": "#{dockerRegistryUsername}#"
        },
        {
          "name": "dockerRegistryPassword",
          "value": "#{dockerRegistryPassword}#"
        },
        {
          "name": "stagingSlotName",
          "value": "#{stagingSlotName}#"
        },
        {
          "name": "networkResourceGroupName",
          "value": "#{networkResourceGroupName}#"
        },
        {
          "name": "networkVnetName",
          "value": "#{networkVnetName}#"
        },
        {
          "name": "networkSubnetName",
          "value": "#{networkSubnetName}#"
        },
        {
          "name": "configCustom",
          "value": {
            "WEBSITES_PORT": 8080
          }
        },
        {
          "name": "alwaysOn",
          "value": true
        }
      ]
    }
  ]
}
